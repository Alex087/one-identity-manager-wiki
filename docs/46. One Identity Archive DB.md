46\. One Identity Archive DB

13 февраля 2026 г.

12:07

 

Есть 3 способа переноса данных в арихивную БД

- Напрямую из основной БД (если базы в одной сети) и нормальные задержки
  по сети

- Через экспорт и импорт xml файлов

- Данные могут удаляться из основной БД, через определенное время без
  архивирования

<img src="../media/46. One Identity Archive DB/media/image1.png"
style="width:5in;height:3.9375in"
alt="One Identity Manager Database One Identity Manager Service HistoryDB Service Direct Import Current History Database , HistoryDB Service XML File Depository One Identity Manager Database Current History Data b " />

 

Если не указать retention period - данные будут удаляться ежедневно по
стандартному расписанию

 

 

Чтобы подтянуть данные в архивную БД - надо из дизайнера запустить
задачу планировщика

"Import process information directly"

 

Изменения сохраняются в таблице DialogWatchProperty

<https://www.oneidentity.com/community/identity-manager/f/forum/5885/history-data-viewing>

 

ID базы данных в таблице DialogDatabase

 

Почему убрали HistoryDB Service

<https://www.oneidentity.com/community/identity-manager/f/forum/29448/history-service>

-----

Получилось заставить JoBServer History DB обрабатывать задания

1\) Установить утилиты His DB на отдельный сервер

2\) Сконфигурировать новую базу данных на SQL сервере, через
конфигуратор нового отдельного сервера

3\) Запустить дизайнер на новом сервере и добавить Job Server (указать
Executing Server!!!)

<img src="../media/46. One Identity Archive DB/media/image2.png"
style="width:6.57292in;height:3.21875in"
alt="Navigation Getting Started Create system user Edit configuration parameters Add job Edit schedules O Getting Started Job servers T-0NElM-D8-4 List Editor Job Server Editor \T-0NElM-D8-4 _HlS_4 x Executing server t-oneim-db4sgp.ru Full server name T-0NElM-Da4.sgp.ru t-oneim-his4sgp.ru Job server It-oneim -his-4 Properties Extended Full server name Executirrg server Parent Job server t-oneim-his4 t-oneim-his4 sgp.ru t-oneim-db4 sgp.ru \T-0NElM-HlS4 No automatic software update Stop One Identity Manager Service Server is cluster One Identity Manager Service installed No direct data base co nnection " />

 

<img src="../media/46. One Identity Archive DB/media/image3.png"
style="width:6.46875in;height:2.6875in"
alt="Sewer function Server function One Identity Manager Service installed SQL processing server CSV script server Default report server SMTP host Update server " />

 

<img src="../media/46. One Identity Archive DB/media/image4.png"
style="width:1.90625in;height:3.03125in"
alt="Machine role role X Oocumentatvon .0 HTML Development E SeNer Job Server " />

 

4\) Зайти в папку на новом сервере с установленным 1IM и
сконфигурировать JobServer (JobServiceConfigurator) на базу History DB

 

Соотнесение таблиц

DialogWatchProperty (Main) ==\> WatchProperty (HDB)

DialogWatchOperation (Main) ==\> WatchOperation (HDB)

JobHistory (Main) ==\> HistoryJob (HDB)

----

Если не заполняется архивная БД - на основной выполнить Daily
Maintenance job и затем Direct Import на архивной. Учесть то, что данные
переносятся по сроку давности, который указан в дизайнере.

Пример настроек

Common\ProcessState\Delete=1  
Common\ProcessState\ExportPolicy=HDB  
Common\ProcessState\JobHistory=ALL  
Common\ProcessState\JobHistory\Delete=1  
Common\ProcessState\JobHistory\isToExport=1  
Common\ProcessState\JobHistory\lifetime=2  
Common\ProcessState\PackageSizeHDB=10000000  
Common\ProcessState\ProgressView=0  
Common\ProcessState\Propertylog=1  
Common\ProcessState\PropertyLog\AllDefaultPropertiesForModel=1 (?)  
Common\ProcessState\PropertyLog\IsToExport=1  
Common\ProcessState\PropertyLog\LifeTime=1

 

Так же в BaseData указать базу для TimeTrace

 

----

<img src="../media/46. One Identity Archive DB/media/image5.png"
style="width:5in;height:2.21875in"
alt="Job queue Job queue Job qu Check SQL Column ScriptEx Execution status TRUE Executing server IT-ONEIM-D84 prüft, 0b nach laufende gleichnamige Ketten in der Jobqueue vorhanden Sind (Import daff nur einmal laufen) Exec Execute SQL el Execute SQL el Execute SQL ScriptExec FALSE FALSE FALSE TRUE IT-ONEIM-D84 IT-ONEIM-D84 IT-ONEIM-D84 IT-ONEIM-D84 " />

----------------------

**Установка 2х служб на один сервер**

Ставим службу архивной БД в отдельную папку с отличающимся именем.

В конфиге службы ставим отличающийся HTTP порт от основной БД

Меняем в конфиге службы путь до логов, чтобы они не сливались в одну
папку.

<img src="../media/46. One Identity Archive DB/media/image6.png"
style="width:5in;height:2.65625in" />

