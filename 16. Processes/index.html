<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>16. Processes - 1IM Wiki</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" disabled>
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" >
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">1IM Wiki</a>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item dropdown">
                              <button id="theme-menu" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme" class="nav-link dropdown-toggle">
                                <i class="fa-solid fa-circle-half-stroke fa-fw"></i>
                                <span class="d-lg-none ms-2">Toggle theme</span>
                              </button>
                              <ul class="dropdown-menu dropdown-menu-end">
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                                    <i class="fa-solid fa-sun fa-fw"></i>
                                    <span class="ms-2">Light</span>
                                    <i class="fa-solid fa-check ms-auto d-none"></i>
                                  </button>
                                </li>
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="true">
                                    <i class="fa-solid fa-moon fa-fw"></i>
                                    <span class="ms-2">Dark</span>
                                    <i class="fa-solid fa-check ms-auto"></i>
                                  </button>
                                </li>
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="auto" aria-pressed="false">
                                    <i class="fa-solid fa-circle-half-stroke fa-fw"></i>
                                    <span class="ms-2">Auto</span>
                                    <i class="fa-solid fa-check ms-auto d-none"></i>
                                  </button>
                                </li>
                              </ul>
                            </li>
                    </ul>
                </div>
            </div>
        </div>
        <script src="../js/darkmode.js"></script>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#_1" class="nav-link"></a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#ad" class="nav-link">Создание группы AD</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#uid" class="nav-link">Передать UID созданной группы на следующий шаг процесса</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#_2" class="nav-link">Срабатывание процесса при создании запроса на портале</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#_3" class="nav-link">Процесс отправки почты заявителю при согласовании процесса</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#values" class="nav-link">values</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#successorerror" class="nav-link">Вызвать ошибку в шаге процесса, чтобы пойти по пути Successor(Error)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#sqlcomponent-exists-where" class="nav-link">SQLComponent - Exists - чтобы не возникала ошибка, когда нет объектов по условию Where</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#_4" class="nav-link">Расчет согласующих в шаге согласования</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#sql" class="nav-link">Вызов хранимой процедуры SQL</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#process-monitoring" class="nav-link">Process Monitoring</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#procid-scripts" class="nav-link">Сохранение объекта с указанием ProcID для поиска в истории.(см в Scripts)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#procid" class="nav-link">ProcID можно использовать для идентификации и связи процессов между собой.</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#assign-remove" class="nav-link">Для некоторых таблиц не отрабатывают события Assign, Remove…</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#_5" class="nav-link">Сравнение дат</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#_6" class="nav-link">Условие выполнения процесса</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#qerworkingstep" class="nav-link">Объяснение путей согласования в таблице QERWorkingStep</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p>16. Processes</p>
<p>9 апреля 2020 г.</p>
<p>10:11</p>
<p><strong>Process Orchestration</strong></p>
<p>В начале процессе в PreScript Generating в конце скрипта не должно быть
(), как в лабе</p>
<p>Заменяем кавычки на нормальные ""</p>
<p>У задания</p>
<p>Designer – Process Orchestration – Process Automation</p>
<p>CCC_Export Person to CSV</p>
<p>Выставил Activation Schedule в Deactivate, а был ССС_Export Person to
CSV</p>
<p>Задание сохряняет результать выполнения скрипта на Job сервере</p>
<h1 id="_1"></h1>
<h1 id="ad">Создание группы AD</h1>
<p>Процесс HandleObjectComponent - Insert</p>
<p><img src="../media/16. Processes/media/image1.png"
style="width:4.59375in;height:3.125in"
alt="Param eters Parameter name V SuthenticationString Connectionprovider ConnectionString ObjectType val CanonicalName val cn val_DistinguishedName val SAMAccountName val UD ADscontainer val UD ADSDomain ConnectionVariabIes Parameter value value = Connectionlnfo.ZuthString Value = Connectionlnfo.ConnectionProvider Value = Connectionlnfo.ConnectionString Value = •ADSGroup• Value = •sgp.rwTest,TestDep2• Value = •TestDep2 Value = Value = •TestDep2 Value = •acd6eOb9-bc4b4b1f-8b80-e001 Value = •a6aef2f2-e3b54soc-be67-1 e8fec8ee8df• Value = IVar21VarY " /></p>
<h1 id="uid">Передать UID созданной группы на следующий шаг процесса</h1>
<p>Надо в шаге создания группы HandleObjectComponent в параметре
ResultingKeyParam указать</p>
<p>Value = "UIDADSGroup"</p>
<p><img src="../media/16. Processes/media/image2.png"
style="width:4.17708in;height:0.64583in"
alt="ObjectWpe ResultingKeyParam val CanonicaIName Value = •ADSGroup• Value = •UlDADSGroup• Value = valuesCCanonicaINan " /></p>
<p>На следующем шаге для параметра val_UID_ADSGroup</p>
<p>Присвоить значение</p>
<p>Value = "&amp;OUT(UIDADSGroup)&amp;"</p>
<p><img src="../media/16. Processes/media/image3.png"
style="width:4.77083in;height:0.625in"
alt="val_DistinguishedName val UlD_ADSGroup val LIID_EXOOrganization Value = Value = Value = •e63d6066-ddc84cOb-ab53-af3f " /></p>
<p><a href="https://slourc.wordpress.com/2015/03/01/d1im-designer-deleguer-automatiquement-les-droits-de-responsable-sur-une-personne-a-un-assistant/">https://slourc.wordpress.com/2015/03/01/d1im-designer-deleguer-automatiquement-les-droits-de-responsable-sur-une-personne-a-un-assistant/</a></p>
<h1 id="_2">Срабатывание процесса при создании запроса на портале</h1>
<p>Manager</p>
<p><img src="../media/16. Processes/media/image4.png"
style="width:11.02083in;height:4.45833in"
alt="Navigation IT Shop Info system IT Shop Request templates Req uests Service catalog Hierarch] by service categories Access Lifecycle Active Directorygroups Employee management Sa30Eble poll&#39; napo,u• Singles Requestable service items Not available service items Predefined &quot;E Custom defined Terms of use &amp;asic configuration data Processirrg status Stardard reasons Employees Organizations • Business Roles Entitlements IT Shop x Service items (1) Recently used C6poc napong so scex C&#39;•1CTeMax C6poc napong so scex cncTeMax Reset Central Password X Result list Tasks Favorites Toolbox AlignIayoLt Approval levels Add Approval steps Assignm ene Remove posibve Remove reroute Remove escalaton Copyworkfiow„ O App roval wo rkfiow overview Change master data Reset Central Password Approva I level Check Pers on Ordered equal Person Ins erted (CD - Calculated Decision) Approval level Security Admin (OR - Memb Approval level Call event (EK- Approvals to be made externally) " /></p>
<p><img src="../media/16. Processes/media/image5.png"
style="width:6.09375in;height:4.625in"
alt="Sirrg lestep Approval procedue Processi ng status o n success Processirrg status o n error Role Fallbackappro• Relevance fo r co m p I iarrce Description Approval reason Reject reason General Mail temp lates Call event EX - Approvals to be made externally Not relevant ResetCentraIPVVD Approval byaffected employee Do not show inapproval history " /></p>
<p>Designer - Процесс</p>
<p><img src="../media/16. Processes/media/image6.png"
style="width:9.25in;height:6.59375in"
alt="Navigation Process Orchestration Processes Customized processes Custom processes AttestationCase Department DialogScheduIe person PersonHasTS&amp;AccountDef PersonWa ntsOrg g] PersonWantsOrg Enable Employee in separate proc g] PersonWantsOrg Enable Temporary Disabled Empl( personWantsOrg Reset Central User g] PersonWantsOrg TemporaryDiszbIe Employee Reset AD Passwo rd UNSAccount8 Process automation Objects without processes Process components Object events Provisionirrg processoperations Getting Started One Identity Manager Schema O Getting Started Schema Editor Reset Central User Set new password L&#39; &quot;Ste Set Central p.rd Send mail with central password Send +rnsil hiving the centr.l to the Hed of prim—ry department Make positive decision for requ Events Process - Person WantsOrg Reset C... • Nake negative decision for requ Sort order Permissions Process Orchestration ResetCentraIP.VO " /></p>
<hr />
<h1 id="_3">Процесс отправки почты заявителю при согласовании процесса</h1>
<p>"VI_ESS_PersonWantsOrg_Send Mail when Closed", connected it to the event
"ORDERGRANTED"</p>
<hr />
<h1 id="values">values</h1>
<p>Pre-Script каждого шага процесса генерируется на отдельной машине.</p>
<p>Тип данных, который позволяет передавать values - только string!</p>
<p>Поэтому, чтобы передать DateTime, например, надо сериализовать в строку
и потом обратно десериализовать в DateTime при передаче переменной между
шагами!</p>
<hr />
<h1 id="successorerror">Вызвать ошибку в шаге процесса, чтобы пойти по пути Successor(Error)</h1>
<p>We've a process to insert account to Target System. At the one of the
step we executing script. If something goes wrong we are throwing an
exception:</p>
<p>Public Function VRS_UNSAccountB_Insert(...) As Boolean</p>
<p>...</p>
<p>If retMessages.Length = 0 Then</p>
<p>Return True</p>
<p>Else</p>
<p><span class="mark">  <strong>Throw New
Exception(retMessages.ToString())</strong></span></p>
<p>End If</p>
<p>End Function</p>
<p>How to pass this exception to "Notification on error" Message body?</p>
<p><img src="../media/16. Processes/media/image7.png"
style="width:3.32292in;height:2.19792in" /></p>
<p>* *</p>
<p>Configure your script or process to throw an exception with your string
object:</p>
<p><span class="mark">Throw New ViException(strMessageForMail)</span></p>
<p>Then in the process notification on error tab in the Message part where
you specify Value = "Something"</p>
<p>You can reference a special parameter called "[AdditionalMessage]"
(must be wrapped in "'s) - this will contain whatever you put in the
string for the exception.</p>
<p><em>From
\&lt;<a href="https://www.oneidentity.com/community/identity-manager/f/forum/22422/how-to-get-exception-message-inside-notification-on-error-message">https://www.oneidentity.com/community/identity-manager/f/forum/22422/how-to-get-exception-message-inside-notification-on-error-message</a>&gt;</em></p>
<hr />
<h1 id="sqlcomponent-exists-where">SQLComponent - Exists - чтобы не возникала ошибка, когда нет объектов по условию Where</h1>
<p>Надо указать в Error Handong - Split Processing</p>
<p><img src="../media/16. Processes/media/image8.png"
style="width:4.46875in;height:2.59375in"
alt="Process step properties General Generation Error handling Extended Latency [min] Log mode Waitmode on error Splitprocessing Ignore errors Stop on error Log errors to journal " /></p>
<p>Split processing</p>
<p>Process steps that are only required for branching the process are
labeled</p>
<p>with this option. An example could be a process step that checks for the</p>
<p>existence of a directory. The next process step to be processed is
either</p>
<p>the step on success or the step on error (without generating an error</p>
<p>message) depending on the return value.</p>
<hr />
<h1 id="_4">Расчет согласующих в шаге согласования</h1>
<p>Отвечает процедура SQL</p>
<p>QER_PITShopHelperFillAll</p>
<p><em>From
\&lt;<a href="https://www.oneidentity.com/community/identity-manager/f/forum/20571/recalculate-workflow-step-when-personhead-change">https://www.oneidentity.com/community/identity-manager/f/forum/20571/recalculate-workflow-step-when-personhead-change</a>&gt;</em></p>
<hr />
<h1 id="sql">Вызов хранимой процедуры SQL</h1>
<p>Dim f As ISqlFormatter = Connection.SqlFormatter</p>
<p>Value = f.StoredProcedure("vi_ReCalcPWOHelperPWO","'|CP|'", "'" &amp;
CStr(Connection.Variables("GenProcID")) &amp; "'")</p>
<p><em>From
\&lt;<a href="https://www.oneidentity.com/community/identity-manager/f/forum/20571/recalculate-workflow-step-when-personhead-change">https://www.oneidentity.com/community/identity-manager/f/forum/20571/recalculate-workflow-step-when-personhead-change</a>&gt;</em></p>
<hr />
<h1 id="process-monitoring">Process Monitoring</h1>
<h1 id="procid-scripts">Сохранение объекта с указанием ProcID для поиска в истории.(см в Scripts)</h1>
<h1 id="procid">ProcID можно использовать для идентификации и связи процессов между собой.</h1>
<p>Если мы имеем 2 таблицы, процесс для первой делает изменения во второй,
то при внесении изменений можно указать ProcID этого процесса, чтобы
потом в DialogWatchOperation можно увидеть, какой процесс связан с этим
изменением (DialogProcess)</p>
<p>Для самого процесса должна стоять галка ProcessHistory для сохранения в
таблице DialogProcess. И для корня процесса - Process Information - Full
process Tracking</p>
<p><img src="../media/16. Processes/media/image9.png"
style="width:3.79167in;height:3.5in" /></p>
<p><img src="../media/16. Processes/media/image10.png"
style="width:3.90625in;height:1.28125in" /></p>
<p>Для того, чтобы видеть изменения по столбцу в DialogWatchOperation для
поля должны стоять галки Log Changes и Log Changes when deleted</p>
<p><img src="../media/16. Processes/media/image11.png"
style="width:3.97917in;height:7.03125in" /></p>
<hr />
<p><strong>В дополнение по мониторингу процесса</strong></p>
<p>Если мы запукаем скрипт и он порождает другие процессы, то эти процессы
можно запускать с одним ProcessID</p>
<ol>
<li>
<p>В процессе, в шаге запука скрипта указываем параметр:
    CStr(Connection.Variables("GenProcID")) - передача ProcID</p>
</li>
<li>
<p>В скрипте делаем параметр типа String - ProcID</p>
</li>
<li>
<p>Проверка на запущенный процесс с ProcID в очереди</p>
</li>
</ol>
<blockquote>
<p>For Index As Integer = 1 To 10</p>
<p>If Session.Source.Exists("JobQueue", String.Format("GenProcID = N'{0}'
and JobChainName \&lt;&gt; N'CCC_SED_DeleteProduct'", ProcID)) Then</p>
<p>Threading.Thread.Sleep(60000)</p>
<p>End If</p>
<p>Next</p>
</blockquote>
<ol>
<li>Запуск процессов с указанным ProcID</li>
</ol>
<blockquote>
<p><strong>Using uow = Session.StartUnitOfWork(ProcID)</strong></p>
<p>For Each colElement As IEntity In colSEDESet</p>
<p>dbESet =
Connection.CreateSingle("Eset",colElement.GetValue("UID_ESet"))</p>
<p>crESetHasEntitlement = dbESet.GetCR("ESetHasEntitlement", "UID_Eset")</p>
<p>For Each colElement1 As IColElem In crESetHasEntitlement.Children</p>
<p>dbESetHasEntitlement1 = colElement1.Create() dbESetHasEntitlement =
Session.Source.Get("ESetHasEntitlement",
colElement1.GetValue("UID_ESetHasEntitlement"))</p>
<p>dbESetHasEntitlement.MarkForDeletion()</p>
<p><strong>uow.Put(dbESetHasEntitlement)</strong></p>
<p>Next</p>
<p>Next</p>
<p><strong>uow.Commit()</strong></p>
</blockquote>
<hr />
<h1 id="assign-remove">Для некоторых таблиц не отрабатывают события Assign, Remove…</h1>
<p>Включить в Designer поле isAssignmentWithEvent</p>
<p><img src="../media/16. Processes/media/image12.png"
style="width:7.75in;height:4.54167in" alt="image" /></p>
<p>Assign by event</p>
<p>Только для таблиц many-to-many</p>
<hr />
<h1 id="_5">Сравнение дат</h1>
<p>\$CCC_dtEmailSent:Date\$ &gt;
<strong>Date.Parse("12/30/1900",CultureInfo.InvariantCulture)</strong></p>
<hr />
<h1 id="_6">Условие выполнения процесса</h1>
<p>Есть скрипт, который выполняется на одном из шагов и результат
выполнения скрипта - строка пустая или нет</p>
<p>Нужно на следующем шаге, в зависимости от результата выполнения скрипта,
выполнять шаг сравнения результата скрипта (CommandComponent - Compare)</p>
<p><img src="../media/16. Processes/media/image13.png"
style="width:6.33333in;height:6.33333in" /></p>
<p><img src="../media/16. Processes/media/image14.png"
style="width:4.15625in;height:6.02083in" /></p>
<p><img src="../media/16. Processes/media/image15.png"
style="width:5.08333in;height:2.63542in" /></p>
<hr />
<h1 id="qerworkingstep">Объяснение  путей согласования в таблице QERWorkingStep</h1>
<p>В QERWorkingStep это поля маршрутизации шага согласования.</p>
<p>PositiveSteps — куда идти при положительном результате шага.
NegativeSteps — куда идти при отрицательном результате шага.</p>
<p>Практически это работает как “смещение по уровням” (jump) внутри UID_QERWorkingMethod:
- 1 = следующий уровень
- 2 = пропустить один и перейти через уровень
- 5 = перейти на уровень +5
- 0 = не переходить дальше (обычно завершение ветки на этом результате)</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
